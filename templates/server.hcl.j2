{% set comma = joiner(",") %}
{% set lbracket = "[" %}
{% set rbracket = "]" %}
{% set quote = '"' %}

# Enable the server
server {
    enabled = true
{% endfor %}{{ rbracket }}
    start_join= {{ lbracket }}{% for host in groups['nomad_cluster_nodes'] %}{% if hostvars[inventory_hostname]['ansible_default_ipv4']['address'] != hostvars[host]['ansible_default_ipv4']['address']  %}{{ comma() }}{{ quote }}{{ hostvars[host]['ansible_default_ipv4']['address'] }}{{ quote }}{% endif %}
{% endfor %}{{ rbracket }}
    retry_join= {{ lbracket }}{% for host in groups['nomad_cluster_nodes'] %}{% if hostvars[inventory_hostname]['ansible_default_ipv4']['address'] != hostvars[host]['ansible_default_ipv4']['address']  %}{{ comma() }}{{ quote }}{{ hostvars[host]['ansible_default_ipv4']['address'] }}{{ quote }}{% endif %}
{% endfor %}{{ rbracket }}
    retry_interval = "15s"
}

# Increase log verbosity
log_level = "DEBUG"
